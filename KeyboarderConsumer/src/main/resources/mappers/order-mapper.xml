<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="orderMapper">

	<resultMap id="orderResultSet" type="order">
		<result column="ORDER_NO" property="orderNo" />
		<result column="ORD_ORDER_DATE" property="orderDate" />
		<result column="ORDER_PRICE" property="orderPrice" />
		<result column="COUPON_YN" property="couponYN" />
		<result column="ORDER_STATUS" property="orderStatus" />
		<result column="PRODUCT_NO" property="productNo" />
		<result column="CON_NO" property="conNo" />
		<result column="ATTACHMENT1" property="productAttachment" />
		<result column="PRODUCT_NAME" property="productName" />
		<result column="PRICE" property="productPrice" />
		<result column="K_COUPON_PRICE" property="keyCouponPrice" />
		<result column="S_COUPON_PRICE" property="stoCouponPrice" />
		<result column="CON_NAME" property="conName" />
		<result column="CON_PHONE" property="conPhone" />
		<result column="ADDRESS" property="conAddress" />
		<result column="SELLER_NAME" property="sellerName" />
	</resultMap>
	
	<select id="foTotalViewList" parameterType="_int" resultMap="orderResultSet">
		SELECT ORDER_NO
		     , TO_CHAR(ORDER_DATE, 'YY-MM-DD') "ORDER_DATE"
		     , ORDER_PRICE
		     , ORDER_STATUS
		     , ORD.PRODUCT_NO
		     , PRODUCT_NAME
		     , ATTACHMENT1
		FROM ORDERS ORD
		JOIN PRODUCT PRO ON (PRO.PRODUCT_NO = ORD.PRODUCT_NO)
		WHERE CON_NO = #{conNo}
		ORDER BY ORDER_DATE DESC
	</select>
	
	<select id="foDetailViewList" parameterType="string" resultMap="orderResultSet">
		SELECT ORD.ORDER_NO
		     , TO_CHAR(ORD.ORDER_DATE, 'YYYY-MM-DD') "ORD_ORDER_DATE"
		     , ORD.ORDER_STATUS
		     , PRO.PRODUCT_NAME
		     , PRO.PRICE
		     , PRO.ATTACHMENT1
		     , KCOU.COUPON_PRICE AS "K_COUPON_PRICE"
		     , SCOU.COUPON_PRICE AS "S_COUPON_PRICE"
		     , CONS.CON_NAME
		     , CONS.CON_PHONE
		     , CONS.ADDRESS
		     , SEL.SELLER_NAME
		FROM ORDERS ORD
		LEFT JOIN PRODUCT PRO ON (PRO.PRODUCT_NO = ORD.PRODUCT_NO)
		LEFT JOIN SELLER SEL ON (PRO.SELLER_NO = SEL.SELLER_NO)
		LEFT JOIN CONSUMER CONS ON (ORD.CON_NO = CONS.CON_NO)
		LEFT JOIN KEYBOARDER_USE KUSE ON (ORD.ORDER_NO = KUSE.ORDER_NO)
		LEFT JOIN STORE_USE SUSE ON(ORD.ORDER_NO = SUSE.ORDER_NO)
		LEFT JOIN COUPON_KEYBOARDER KCOU ON (KUSE.COUPON_NO = KCOU.COUPON_NO)
		LEFT JOIN COUPON_STORE SCOU ON (SUSE.COUPON_NO = SCOU.COUPON_NO)
		WHERE SUSE.ORDER_NO = #{ordNo}
		   OR KUSE.ORDER_NO = #{ordNo}
		   OR SUSE.ORDER_NO IS NULL AND KUSE.ORDER_NO IS NULL
	</select>
	

</mapper>

































