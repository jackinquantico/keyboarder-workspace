<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="poCouponMapper">

	<resultMap id="poCouponResultMap" type="poCoupon">
		<result column="COUPON_NO" property="couponNo" />
		<result column="COUPON_NAME" property="couponName" />
		<result column="COUPON_PRICE" property="couponPrice" />
		<result column="CREATE_DATE" property="createDate" />
		<result column="USE_DATE" property="useDate" />
		<result column="DUE_DATE" property="dueDate" />
		<result column="COUPON_STMT" property="couponStmt" />
		<result column="SELLER_NO" property="sellerNo" />
		<result column="PRODUCT_NAME" property="productName" />
	</resultMap>
	
	
	
	<insert id ="insertCoupon" parameterType="poCoupon">
	
	INSERT INTO COUPON_STORE(COUPON_NO,
							 COUPON_NAME,
							 COUPON_PRICE,
							 CREATE_DATE,
							 DUE_DATE,
							 PRODUCT_NO,
							SELLER_NO
							)
VALUES('k'||SEQ_COUPON_STORE_NO.NEXTVAL,
		#{couponName},
		#{couponPrice},
		#{createDate},
		#{dueDate},
		#{productNo},
		#{sellerNo}
		)							 
	</insert>
	
	<select id="showAbleCouponList" parameterType="poCoupon" resultMap="poCouponResultMap">
	
	 SELECT COUPON_NO as "COUPON_NO",
            COUPON_NAME as "COUPON_NAME",
            COUPON_PRICE as "COUPON_PRICE",
            P.PRODUCT_NAME as "PRODUCT_NAME",
            COUPON_STMT as "COUPON_STMT",
            TO_CHAR(CREATE_DATE, 'YYYY-MM-DD') AS "CREATE_DATE",
            TO_CHAR(DUE_DATE, 'YYYY-MM-DD') AS "DUE_DATE"
            FROM COUPON_STORE S
            LEFT JOIN PRODUCT P ON (P.PRODUCT_NO=S.PRODUCT_NO)
           	WHERE S.SELLER_NO=#{sellerNo}
            <choose>
			<when test='couponStmt == "N"'>
				AND COUPON_STMT = 'N'
				<if test='fromDate != null'>
					AND CREATE_DATE BETWEEN #{fromDate} AND #{toDate}
				</if>
			</when>
			<when test='couponStmt == "Y"'>
				AND COUPON_STMT = 'Y'
				<if test='fromDate != null'>
					AND CREATE_DATE BETWEEN #{fromDate} AND #{toDate}
				</if>
			</when>
		</choose>
            ORDER BY COUPON_NO DESC
	</select>
	
	
	</mapper>
	