<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="boCouponMapper">

	<resultMap id="boCouponResultMap" type="boCoupon">
		<result column="COUPON_NO" property="couponNo" />
		<result column="COUPON_NAME" property="couponName" />
		<result column="COUPON_PRICE" property="couponPrice" />
		<result column="CREATE_DATE" property="createDate" />
		<result column="DUE_DATE" property="dueDate" />
		<result column="COUPON_STMT" property="couponStmt" />
		<result column="PRODUCT_NO" property="productNo" />
		<result column="PRODUCT_NAME" property="productName" />
	</resultMap>

	<select id="selectCouponList" parameterType="boCoupon" resultMap="boCouponResultMap">
		SELECT COUPON_NO
	            , COUPON_NAME
	            , COUPON_PRICE
	            , TO_CHAR(CREATE_DATE, 'YYYY-MM-DD') AS "CREATE_DATE"
	            , TO_CHAR(DUE_DATE, 'YYYY-MM-DD') AS "DUE_DATE"
	            , CASE WHEN COUPON_STMT = 'Y' THEN '사용가능'
                       WHEN COUPON_STMT = 'N' THEN '사용불가'
              	  END AS "COUPON_STMT"
	            , C.PRODUCT_NO AS "PRODUCT_NO"
	            , PRODUCT_NAME
		FROM COUPON_KEYBOARDER C
		JOIN PRODUCT P ON (P.PRODUCT_NO = C.PRODUCT_NO)
		<choose>
			<when test='couponStmt == "N"'>
				WHERE COUPON_STMT = 'N'
				<if test='startDate != null'>
					AND CREATE_DATE BETWEEN #{startDate} AND #{endDate}
				</if>
			</when>
			<when test='couponStmt == "Y"'>
				WHERE COUPON_STMT = 'Y'
				<if test='startDate != null'>
					AND CREATE_DATE BETWEEN #{startDate} AND #{endDate}
				</if>
			</when>
		</choose>
		ORDER BY COUPON_NO DESC
	</select>
	
	<insert id="insertCoupon" parameterType="boCoupon">
		INSERT INTO COUPON_KEYBOARDER (COUPON_NO
		                             , COUPON_NAME
		                             , COUPON_PRICE
		                             , CREATE_DATE
		                             , DUE_DATE
		                             , PRODUCT_NO)                             
		VALUES('K'||SEQ_COUPON_KEYBOARDER_NO.NEXTVAL
		     , #{couponName}
		     , #{couponPrice}
		     , #{createDate}
		     , #{dueDate}
		     , #{productNo})
	</insert>

</mapper>
